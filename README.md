## Опис проекту
Проект являє собою електронний пристрій на базі Arduino Uno. Дозволяє робити наступне:
- Зчитувати монети номіналом 1, 2, 5, 10 грн
- Підраховувати загальну кількість складених монет.
- Виставляти ціль накопичення 
- При досягненні цілі відкривається замок.
- Рух вушками-сервоприводами при отриманні монетки

## Інструкція з налаштування 
### Перший запуск 
 Після включення на екрані бачимо привітання з назвою проекту та назначення кнопок керування. Коли на екрані з'явиться повідомлення "Put money ->", потрібно виставити ціль.

### Налаштування цілі
Після натискання кнопки __справа__ переходимо до меню налаштування. Кнопками можна додавати або віднімати бажану суму накопичення з кроком 5(за замовчуванням). 
Для виходу з меню - очікувати __2 секунди__.

### Скидання суми
Для скидання суми до 0 потрібно при запуску утримати кнопку __зліва__, дочекатись повідомлення "Memory cleared" та відпустити кнопку. Ціль та сума після цього будуть дорівнювати 0.

## Технічна частина 
### Використані компоненти 
| Компонент                  | Кількість | Призначення                       |
| -------------------------- | --------- | --------------------------------- |
| Arduino Uno                | 1         | Основний контролер                |
| LCD 1602 I2C               | 1         | Для відображення суми             |
| ІЧ-сенсор (фототранзистор) | 1         | Для зчитування сигналу від монети |
| Серводвигуни               | 2         | Для руху вушок                    |
| Електромагнітний замок     | 1         | Відкривається при досягненні цілі |
| Реле                       | 1         | Для керування замком              |
| Кнопки                     | 2         | Для керування ціллю, скиданням    |
| EEPROM (вбудована)         | –         | Для збереження суми та цілі       |
| Резистори, провідники      | ∼         | Для підключення                   |
| Джерело живлення           | 1         | Бажано 9V, мінімум 600А           |
| Акумулятор 9V              | 1         | Живлення замка                    |
### Підключення
```c++
#define RIGHT_BUTTON  3   //Права кнопка
#define LEFT_BUTTON   2   //Ліва кнопка
#define IRpin         17  //ІЧ світлодіод
#define IRsens        14  //Фототранизистор
#define LEFT_SERVO    7   //Лівий сервопривід
#define RIGHT_SERVO   8   //Правий сервопривід
#define RELAY         10  //Керування реле
```
Порти живлення усіх компонентів підключені до 5В плати Arduino. 


### Алгорим розпізнавання монети
Суть алгоритму полягає в тому, щоб в момент збільшення отриманого сигналу, зберігати кожне наступне значення(якщо воно більше за попереднє). Як тільки наближаємося до рівня пустого сигналу(монета майже впала), виставляємо флаг монетки. Коли вже монета точно впала, проходимося по всім збереженим значенням, і перевіряємо різницю між піковим сигналом та сигналами з масиву. Якщо ця різниця по модулю менше ніж 30, додаємо монетку до суми, та перезаписуємо суму в EEPROM.
```c++
 ir_signal = analogRead(IRsens);
    if (ir_signal > last_signal) last_signal = ir_signal;
    if (ir_signal - empty_signal > 5 ) coin_flag = true;
    if (coin_flag && (abs(ir_signal - empty_signal)) < 5) {
      for (byte i = 0; i < coin_amount; i++) {
        int diff = abs(last_signal - coin_signal[i]);
        if (diff < 30) {
          summ_money += coin_value[i];
          lcd.setCursor(0, 1); lcd.print(summ_money);
          if (summ_money >= goal) remove_lock();
          EEPROM.write(SUM_ADR, summ_money);
          moveServos();
          break;
        }
      }
      coin_flag = false;
      break;
    }
```
Складність полягає тільки в попередньому калібруванні, щоб отримати точні значення для кожної з монет. На даний момент використовувався цей самий алгоритм та запис значень вручну. В подальшому цей функціонал може бути винесений в окремий режим.

### Магнітний замок
Магнітний замок працює від окремого джерела живлення, через високе споживання струму в момент відкривання. Замок потребує 12В, тому акумулятор був під'єднаний до підвищюючого DC-DC перетворювача, який налаштований рівно на 12 Вольт. При звичайному користуванні замок відкриватиметься дуже рідко і на короткий проміжок часу, тобто одного заряду батареї вистачить на дуже тривалий період.
